$(document).ready(function(){$("#add_feed").click(function(){var b=$("#add_feed_txt");b.hasClass("selected")?($("#add_feed_hidden").slideUp("fast"),b.removeClass("selected")):($("#add_feed_hidden").slideDown("fast"),b.addClass("selected"))});$("input.error").live("keydown",function(){$(this).removeClass("error")});$("#rss_submit").click(function(){var b=$("#alias").val(),a=null;b||($("#alias").addClass("error"),a=!0);var d=$("#ttl").val();d||($("#ttl").addClass("error"),a=!0);var c=$("#url").val();
c?c=encodeURIComponent(c):($("#url").addClass("error"),a=!0);if(a)return!1;socket.send("request=add_rss&alias="+b+"&ttl="+d+"&uri="+c)});$(".remote_row").live("click",function(){var b=$(this).next();b.hasClass("hidden")?(b.slideDown("fast"),b.removeClass("hidden")):(b.slideUp("fast"),b.addClass("hidden"))});$(".rss_delete").live("click",function(){var b=$(this).parent().parent().parent().attr("id").split("feed_")[1];confirm("Are you sure you want to delete this RSS feed?")&&socket.send("request=remove_rss&ID="+
b)});$(".rss_enable").live("click",function(){var b=$(this).parent().parent().parent().attr("id").split("feed_")[1];socket.send("request=enable_rss&ID="+b)});$(".rss_disable").live("click",function(){var b=$(this).parent().parent().parent().attr("id").split("feed_")[1];socket.send("request=disable_rss&ID="+b)});$(".add_filter_button").live("click",function(){var b=$(this).parents(".remote_setting").attr("id").split("feed_")[1],a=!0,d=[],c=[],e=null,g=null;$(this).closest(".add_filter_div").children().each(function(){if($(this).hasClass("add_filter")&&
""!==$(this).children("input[type=text]")[0].value)a=$(this).find("div > input[type=checkbox]")[0].checked,d.push($(this).children("input[type='text']")[0].value);else if($(this).hasClass("and_filter")&&""!==$(this).children("input")[0].value)d.push($(this).children("input")[0].value);else if($(this).hasClass("not_filter")&&""!==$(this).children("input")[0].value)c.push($(this).children("input")[0].value);else if($(this).hasClass("size_filter")){var b=$(this).children("input")[0].value,h=$(this).children("select")[1].value,
f=$(this).children("input")[1].value,k=$(this).children("select")[2].value;if(""!=b||""!=f)e?(alert("More than one size limit has been specified, remove the second and try again"),g=!0):(""==b&&(b=0),""==f&&(f=0),e=[b*h,f*k])}});if(g)return!1;e=e?e.join("||||||"):"";d=0==d.length?"":d.join("||||||");c=0==c.length?"":c.join("||||||");$(this).closest(".remote_setting").attr("id").split("remote_settings_");if(""!=d||""!=c||""!=e)b="request=add_rss_filter&ID="+b+("&regex="+a),b+="&positive="+encodeURIComponent(d),
b+="&negative="+encodeURIComponent(c),b+="&sizelim="+encodeURIComponent(e),socket.send(b)});$(".filter_group").live("click",function(){var b=$(this).parents(".remote_setting").attr("id").split("feed_")[1],a=$(".filter_group",$(this).parent()).index($(this));confirm("Are you sure you want to remove this filter?")&&socket.send("request=remove_rss_filter&ID="+b+"&index="+a)})});function onOpen(b){console.log("autoSocket opened",b,socket);runInit()}
function onMessage(b){if("pong"!=b.data)if(0===b.data.indexOf("ERROR"))console.log(b.data),socket.close();else{var a=JSON.parse(b.data);if("get_rss"==a.request){if(a.error)return console.log("ERROR in request "+a.request+": "+a.error),!1;runPostInit(a.response)}else if("add_rss"==a.request){if(a.error)return alert("ERROR in request "+a.request+": "+a.error),!1;window.location.replace(window.location)}else if("remove_rss"==a.request){if(a.error)return alert("ERROR in request "+a.request+": "+a.error),
!1;window.location.replace(window.location)}else if("enable_rss"==a.request){if(a.error)return alert("ERROR in request "+a.request+": "+a.error),!1;socket.send("request=get_rss_single&ID="+a.name)}else if("disable_rss"==a.request){if(a.error)return alert("ERROR in request "+a.request+": "+a.error),!1;socket.send("request=get_rss_single&ID="+a.name)}else if("add_rss_filter"==a.request){if(a.error)return console.log("ERROR in request "+a.request+": "+a.error),!1;socket.send("request=get_rss_single&ID="+
a.name)}else if("remove_rss_filter"==a.request){if(a.error)return console.log("ERROR in request "+a.request+": "+a.error),!1;socket.send("request=get_rss_single&ID="+a.name)}else if("get_rss_single"==a.request){if(a.error)return console.log("ERROR in request "+a.request+": "+a.error),!1;b=a.name;a=a.response;$("#feed_id_"+b).replaceWith($(a[0]));a=$(a[1]);$("#feed_"+b).children().replaceWith(a.children())}else console.log("socket message:",b.data)}}
function runInit(){socket.send("request=get_rss")}function runPostInit(b){$("div#temp").remove();var a=$("table#feeds > tbody");for(i=0;i<b.length;i++)a.append($(b[i]))};
