var sock=null,socket_protocol="https:"==window.document.location.protocol?"wss":"ws";
$(document).ready(function(){var a=window.location.pathname;sock=new window.WebSocket(socket_protocol+"://"+window.location.host+a.substring(0,a.lastIndexOf("/")+1)+"createsocket");sock.onmessage=handleMessage;sock.onerror=function(a){console.log("socket error",a,sock)};sock.onopen=function(a){console.log("socket opened",a,sock)};sock.onclose=function(a){console.log("socket closed",a,sock)};setInterval(function(){sock.send("ping")},4E4);$("#path").keyup(function(a){sock.send("request=exists&path="+
$(this).val())});$("#path_browse").click(function(a){if($("#path_browse_div").hasClass("hidden"))$("#path_browse_div").removeClass("hidden"),initTree();else return $("#path_browse_div").addClass("hidden"),$("#path_browse_div").empty(),!1});$("#create").click(function(a){submitForm()});$(".filetree_item").live("click",function(){var a=$(this).next().html();$(".filetree_item").each(function(){$(this).removeClass("selected")});$(this).addClass("selected");$("#path").val(a)})});
function initTree(){$("#path_browse_div");var a=$("#root_dir").html();sock.send("request=filetree&rootDir="+a)}
function submitForm(){var a=!1,d=$("#path").val(),c=$("#announce").val();c||($("#announce").css("border","1px solid red").css("color","red").keydown(function(){$(this).css("border","").css("color","")}),a=!0);var f=$("#piece").val(),g=$("#private").val(),e=$("#comment").val();e||(e=$("#comment").attr("placeholder"));var b=$("#output").val();if(b)b.indexOf(".torrent")!==b.length-8&&(b+=".torrent",$("#output").val(b));else{b="";for(i=0;15>i;i++)b+="abcdefghijklmnopqrstuvwxyz"[Math.floor(26*Math.random())];
b+=".torrent";$("#output").val(b)}if(a)return!1;$("#progressbar").removeClass("hidden");$("#progressval").removeClass("hidden");$("#progressbar").progressbar({value:0});a="request=create&path="+d+("&announce="+c);a+="&piece="+f;a+="&private="+g;a+="&comment="+e;a+="&output="+b;sock.send(a)}
function handleMessage(a){if(0==a.data.indexOf("ERROR"))console.log("socket error:",a.data);else if("pong"!=a.data){a=JSON.parse(a.data);var d=a.request,c=a.response;"filetree"==d?(a=$(c),a.treeview({collapsed:!0}),$("#path_browse_div").append(a)):"exists"==d?c?$("#path").css("color",""):$("#path").css("color","red"):"create"==d?!0===c?($("#progressbar").addClass("hidden"),constructTorrent(a.output)):isNaN(c)?console.log(c):$("#progressbar").progressbar("option","value",c):console.log("request:",
d,"response:",c)}}function constructTorrent(a){var d=$("<div />").addClass("downloadme"),c=$("<img />").attr("src","images/document.png").attr("title","Download torrent");a=$("<a href='downloadcreation?filename="+a+"' />").append(c);d.append(a);$("#progressbar").parent().append(d)};
