/*
 * Included:
 * jquery.contextmenu.r2.js
 * jquery-sliderow.js
 * liteaccordion.jquery.min.js
 * jquery.treeview.js
 * jquery.cookie.js
 * main.js
 */
(function(a){var b,c,d,e,f,g;var h={menuStyle:{listStyle:'none',padding:'1px',margin:'0px',backgroundColor:'#fff',border:'1px solid #999',width:'100px'},itemStyle:{margin:'0px',color:'#000',display:'block',cursor:'default',padding:'3px',border:'1px solid #fff',backgroundColor:'transparent'},itemHoverStyle:{border:'1px solid #0a246a',backgroundColor:'#b6bdd2'},eventPosX:'pageX',eventPosY:'pageY',shadow:true,onContextMenu:null,onShowMenu:null};a.fn.contextMenu=function(d,e){if(!b)b=a('<div id="jqContextMenu"></div>').hide().css({position:'absolute',zIndex:'500'}).appendTo('body').bind('click',function(a){a.stopPropagation();});if(!c)c=a('<div></div>').css({backgroundColor:'#000',position:'absolute',opacity:0.2,zIndex:499}).appendTo('body').hide();f=f||[];f.push({id:d,menuStyle:a.extend({},h.menuStyle,e.menuStyle||{}),itemStyle:a.extend({},h.itemStyle,e.itemStyle||{}),itemHoverStyle:a.extend({},h.itemHoverStyle,e.itemHoverStyle||{}),bindings:e.bindings||{},shadow:e.shadow||e.shadow===false?e.shadow:h.shadow,onContextMenu:e.onContextMenu||h.onContextMenu,onShowMenu:e.onShowMenu||h.onShowMenu,eventPosX:e.eventPosX||h.eventPosX,eventPosY:e.eventPosY||h.eventPosY});var g=f.length-1;a(this).bind('contextmenu',function(a){var b=(!!f[g].onContextMenu)?f[g].onContextMenu(a):true;if(b)i(g,this,a,e);return false;});return this;};function i(d,h,i,k){var l=f[d];e=a('#'+l.id).find('ul:first').clone(true);e.css(l.menuStyle).find('li').css(l.itemStyle).hover(function(){a(this).css(l.itemHoverStyle);},function(){a(this).css(l.itemStyle);}).find('img').css({verticalAlign:'middle',paddingRight:'2px'});b.html(e);if(!!l.onShowMenu)b=l.onShowMenu(i,b);a.each(l.bindings,function(c,d){a('#'+c,b).bind('click',function(a){j();d(h,g);});});b.css({'left':i[l.eventPosX],'top':i[l.eventPosY]}).show();if(l.shadow)c.css({width:b.width(),height:b.height(),left:i.pageX+2,top:i.pageY+2}).show();a(document).one('click',j);}function j(){b.hide();c.hide();}a.contextMenu={defaults:function(b){a.each(b,function(b,c){if(typeof c=='object'&&h[b])a.extend(h[b],c);else h[b]=c;});}};})(jQuery);$(function(){$('div.contextMenu').hide();});(function(a){var b={defaults:{slideSpeed:400,easing:false,callback:false},thisCallArgs:{slideSpeed:400,easing:false,callback:false},methods:{up:function(c,d,e){if(typeof c=='object')for(p in c)b.thisCallArgs.eval(p)=c[p];else if(typeof c!='undefined'&&(typeof c=='number'||c=='slow'||c=='fast'))b.thisCallArgs.slideSpeed=c;else b.thisCallArgs.slideSpeed=b.defaults.slideSpeed;if(typeof d=='string')b.thisCallArgs.easing=d;else if(typeof d=='function')b.thisCallArgs.callback=d;else if(typeof d=='undefined')b.thisCallArgs.easing=b.defaults.easing;if(typeof e=='function')b.thisCallArgs.callback=e;else if(typeof e=='undefined'&&typeof d!='function')b.thisCallArgs.callback=b.defaults.callback;var f=a(this).find('td');f.wrapInner('<div class="slideRowUp" />');var g=f.css('padding');$cellContentWrappers=a(this).find('.slideRowUp');$cellContentWrappers.slideUp(b.thisCallArgs.slideSpeed,b.thisCallArgs.easing).parent().animate({paddingTop:'0px',paddingBottom:'0px'},{complete:function(){a(this).children('.slideRowUp').replaceWith(a(this).children('.slideRowUp').contents());a(this).parent().css({'display':'none'});a(this).css({'padding':g});}});var h=setInterval(function(){if($cellContentWrappers.is(':animated')===false){clearInterval(h);if(typeof b.thisCallArgs.callback=='function')b.thisCallArgs.callback.call(this);}},100);return a(this);},down:function(c,d,e){if(typeof c=='object')for(p in c)b.thisCallArgs.eval(p)=c[p];else if(typeof c!='undefined'&&(typeof c=='number'||c=='slow'||c=='fast'))b.thisCallArgs.slideSpeed=c;else b.thisCallArgs.slideSpeed=b.defaults.slideSpeed;if(typeof d=='string')b.thisCallArgs.easing=d;else if(typeof d=='function')b.thisCallArgs.callback=d;else if(typeof d=='undefined')b.thisCallArgs.easing=b.defaults.easing;if(typeof e=='function')b.thisCallArgs.callback=e;else if(typeof e=='undefined'&&typeof d!='function')b.thisCallArgs.callback=b.defaults.callback;var f=a(this).find('td');f.wrapInner('<div class="slideRowDown" style="display:none;" />');$cellContentWrappers=f.find('.slideRowDown');a(this).show();$cellContentWrappers.slideDown(b.thisCallArgs.slideSpeed,b.thisCallArgs.easing,function(){a(this).replaceWith(a(this).contents());});var g=setInterval(function(){if($cellContentWrappers.is(':animated')===false){clearInterval(g);if(typeof b.thisCallArgs.callback=='function')b.thisCallArgs.callback.call(this);}},100);return a(this);}}};a.fn.slideRow=function(a,c,d,e){if(typeof a!='undefined')if(b.methods[a])return b.methods[a].apply(this,Array.prototype.slice.call(arguments,1));};})(jQuery);(function(a){var b=function(b,c){var d={containerWidth:960,containerHeight:320,headerWidth:48,activateOn:"click",firstSlide:1,slideSpeed:800,onTriggerSlide:function(){},onSlideAnimComplete:function(){},autoPlay:false,pauseOnHover:false,cycleSpeed:6000,easing:"swing",theme:"basic",rounded:false,enumerateSlides:false,linkable:false},e=a.extend({},d,c),f=b.children("ol").children("li"),g=f.children(":first-child"),h=f.length,i=e.containerWidth-h*e.headerWidth,j={play:function(a){var b=k.nextSlide(a&&a);if(k.playing)return;k.playing=setInterval(function(){g.eq(b()).trigger("click.liteAccordion");},e.cycleSpeed);},stop:function(){clearInterval(k.playing);k.playing=0;},next:function(){j.stop();g.eq(k.currentSlide===h-1?0:k.currentSlide+1).trigger("click.liteAccordion");},prev:function(){j.stop();g.eq(k.currentSlide-1).trigger("click.liteAccordion");},destroy:function(){j.stop();a(window).unbind(".liteAccordion");b.attr("style","").removeClass("accordion basic dark light stitch").removeData("liteAccordion").unbind(".liteAccordion").find("li > :first-child").unbind(".liteAccordion").filter(".selected").removeClass("selected").end().find("b").remove();f.removeClass("slide").children().attr("style","");},debug:function(){return{elem:b,defaults:d,settings:e,methods:j,core:k};}},k={setStyles:function(){b.width(e.containerWidth).height(e.containerHeight).addClass("accordion").addClass(e.rounded&&"rounded").addClass(e.theme);f.addClass("slide").children(":first-child").width(e.containerHeight).height(e.headerWidth).eq(e.firstSlide-1).addClass("selected");g.each(function(b){var c=a(this),d=b*e.headerWidth,f=g.first().next(),h=parseInt(f.css("marginLeft"),10)||parseInt(f.css("marginRight"),10)||0;if(b>=e.firstSlide)d+=i;c.css("left",d).next().width(i-h).css({left:d,paddingLeft:e.headerWidth});e.enumerateSlides&&c.append("<b>"+(b+1)+"</b>");});},bindEvents:function(){if(e.activateOn==="click")g.bind("click.liteAccordion",k.triggerSlide);else if(e.activateOn==="mouseover")g.bind({"mouseover.liteAccordion":k.triggerSlide,"click.liteAccordion":k.triggerSlide});if(e.pauseOnHover&&e.autoPlay)b.bind("mouseover.liteAccordion",function(){k.playing&&j.stop();}).bind("mouseout.liteAccordion",function(){!k.playing&&j.play(k.currentSlide);});},linkable:function(){var b=(function(){var c=[];f.each(function(){if(a(this).attr("name"))c.push((a(this).attr("name")).toLowerCase());});return b=c;})();var c=function(c){var d;if(c.type==="load"&&!window.location.hash)return;if(c.type==="hashchange"&&k.playing)return;d=a.inArray((window.location.hash.slice(1)).toLowerCase(),b);if(d>-1&&d<b.length)g.eq(d).trigger("click.liteAccordion");};a(window).bind({"hashchange.liteAccordion":c,"load.liteAccordion":c});},currentSlide:e.firstSlide-1,nextSlide:function(a){var b=a+1||k.currentSlide+1;return function(){return b++%h;};},playing:0,animSlideGroup:function(b,c,d){var g=d?":lt("+(b+1)+")":":gt("+b+")";f.filter(g).each(function(){var b=a(this),g=f.index(b);b.children().stop(true).animate({left:(d?0:i)+g*e.headerWidth},e.slideSpeed,e.easing,function(){if(!k.slideAnimCompleteFlag){e.onSlideAnimComplete.call(c);k.slideAnimCompleteFlag=true;}});});},slideAnimCompleteFlag:false,triggerSlide:function(b){var c=a(this),d=g.index(c),f=c.next();k.currentSlide=d;k.slideAnimCompleteFlag=false;g.removeClass("selected").filter(c).addClass("selected");if(b.originalEvent&&e.autoPlay){j.stop();j.play(d);}if(e.linkable&&!k.playing)window.location.hash=c.parent().attr("name");e.onTriggerSlide.call(f);k.animSlideGroup(d,f,true);k.animSlideGroup(d,f);},ieClass:function(){var c=+(a.browser.version).charAt(0);if(c<7)j.destroy();if(c===7||c===8)f.each(function(b){a(this).addClass("slide-"+b);});b.addClass("ie ie"+c);},init:function(){if(a.browser.msie)k.ieClass();k.setStyles();k.bindEvents();if(e.cycleSpeed<e.slideSpeed)e.cycleSpeed=e.slideSpeed;if(e.linkable&&"onhashchange" in window)k.linkable();e.autoPlay&&j.play();}};k.init();return j;};a.fn.liteAccordion=function(a){var c=this,d=c.data("liteAccordion");if(typeof a==="object"||!a){return c.each(function(){var e;if(d)return;e=new b(c,a);c.data("liteAccordion",e);});}else if(typeof a==="string"&&d[a])if(a==="debug")return d[a].call(c);else{d[a].call(c);return c;}};})(jQuery);;(function(a){a.extend(a.fn,{swapClass:function(a,b){var c=this.filter('.'+a);this.filter('.'+b).removeClass(b).addClass(a);c.removeClass(a).addClass(b);return this;},replaceClass:function(a,b){return this.filter('.'+a).removeClass(a).addClass(b).end();},hoverClass:function(b){b=b||"hover";return this.hover(function(){a(this).addClass(b);},function(){a(this).removeClass(b);});},heightToggle:function(a,b){a?this.animate({height:"toggle"},a,b):this.each(function(){jQuery(this)[jQuery(this).is(":hidden")?"show":"hide"]();if(b)b.apply(this,arguments);});},heightHide:function(a,b){if(a)this.animate({height:"hide"},a,b);else{this.hide();if(b)this.each(b);}},prepareBranches:function(a){if(!a.prerendered){this.filter(":last-child:not(ul)").addClass(b.last);this.filter((a.collapsed?"":"."+b.closed)+":not(."+b.open+")").find(">ul").hide();}return this.filter(":has(>ul)");},applyClasses:function(c,d){this.filter(":has(>ul):not(:has(>a))").find(">span").click(function(b){d.apply(a(this).next());}).add(a("a",this)).hoverClass();if(!c.prerendered){this.filter(":has(>ul:hidden)").addClass(b.expandable).replaceClass(b.last,b.lastExpandable);this.not(":has(>ul:hidden)").addClass(b.collapsable).replaceClass(b.last,b.lastCollapsable);this.prepend("<div class=\""+b.hitarea+"\"/>").find("div."+b.hitarea).each(function(){var b="";a.each(a(this).parent().attr("class").split(" "),function(){b+=this+"-hitarea ";});a(this).addClass(b);});}this.find("div."+b.hitarea).click(d);},treeview:function(c){c=a.extend({cookieId:"treeview"},c);if(c.add)return this.trigger("add",[c.add]);if(c.toggle){var d=c.toggle;c.toggle=function(){return d.apply(a(this).parent()[0],arguments);};}function e(c,d){function e(d){return function(){f.apply(a("div."+b.hitarea,c).filter(function(){return d?a(this).parent("."+d).length:true;}));return false;};}a("a:eq(0)",d).click(e(b.collapsable));a("a:eq(1)",d).click(e(b.expandable));a("a:eq(2)",d).click(e());}function f(){a(this).parent().find(">.hitarea").swapClass(b.collapsableHitarea,b.expandableHitarea).swapClass(b.lastCollapsableHitarea,b.lastExpandableHitarea).end().swapClass(b.collapsable,b.expandable).swapClass(b.lastCollapsable,b.lastExpandable).find(">ul").heightToggle(c.animated,c.toggle);if(c.unique)a(this).parent().siblings().find(">.hitarea").replaceClass(b.collapsableHitarea,b.expandableHitarea).replaceClass(b.lastCollapsableHitarea,b.lastExpandableHitarea).end().replaceClass(b.collapsable,b.expandable).replaceClass(b.lastCollapsable,b.lastExpandable).find(">ul").heightHide(c.animated,c.toggle);}function g(){function b(a){return a?1:0;}var d=[];i.each(function(b,c){d[b]=a(c).is(":has(>ul:visible)")?1:0;});a.cookie(c.cookieId,d.join(""));}function h(){var b=a.cookie(c.cookieId);if(b){var d=b.split("");i.each(function(b,c){a(c).find(">ul")[parseInt(d[b])?"show":"hide"]();});}}this.addClass("treeview");var i=this.find("li").prepareBranches(c);switch(c.persist){case "cookie":var j=c.toggle;c.toggle=function(){g();if(j)j.apply(this,arguments);};h();break;case "location":var k=this.find("a").filter(function(){return this.href.toLowerCase()==location.href.toLowerCase();});if(k.length)k.addClass("selected").parents("ul, li").add(k.next()).show();break;}i.applyClasses(c,f);if(c.control){e(this,c.control);a(c.control).show();}return this.bind("add",function(d,e){a(e).prev().removeClass(b.last).removeClass(b.lastCollapsable).removeClass(b.lastExpandable).find(">.hitarea").removeClass(b.lastCollapsableHitarea).removeClass(b.lastExpandableHitarea);a(e).find("li").andSelf().prepareBranches(c).applyClasses(c,f);});}});var b=a.fn.treeview.classes={open:"open",closed:"closed",expandable:"expandable",expandableHitarea:"expandable-hitarea",lastExpandableHitarea:"lastExpandable-hitarea",collapsable:"collapsable",collapsableHitarea:"collapsable-hitarea",lastCollapsableHitarea:"lastCollapsable-hitarea",lastCollapsable:"lastCollapsable",lastExpandable:"lastExpandable",last:"last",hitarea:"hitarea"};a.fn.Treeview=a.fn.treeview;})(jQuery);(function(a){a.cookie=function(b,c,d){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(c))||c===null||c===undefined)){d=a.extend({},d);if(c===null||c===undefined)d.expires=-1;if(typeof d.expires==='number'){var e=d.expires,f=d.expires=new Date();f.setDate(f.getDate()+e);}c=String(c);return(document.cookie=[encodeURIComponent(b),'=',d.raw?c:encodeURIComponent(c),d.expires?'; expires='+d.expires.toUTCString():'',d.path?'; path='+d.path:'',d.domain?'; domain='+d.domain:'',d.secure?'; secure':''].join(''));}d=c||{};var g=d.raw?function(a){return a;}:decodeURIComponent;var h=document.cookie.split('; ');for(var i=0,j;j=h[i]&&h[i].split('=');i++)if(g(j[0])===b)return g(j[1]||'');return null;};})(jQuery);var CTRL_SELECTED=false;var SELECTED=new Array();var statusArrayInactive=new Array("Stopped","Paused");var statusArrayActive=new Array("Seeding (idle)","Seeding","Leeching (idle)","Leeching","Hashing");var DELETING=new Array();var DROP_OPEN=new Array();var ws=null;var dragOverlayOpen=null;var dragOverlayCreated=null;if(window.document.location.protocol=="https:")var socket_protocol="wss";else var socket_protocol="ws";var refresh_rate=5000;$(document).ready(function(){setTimeout(function(){refresh_content("yes");},refresh_rate);ws=new window.WebSocket(socket_protocol+"://"+window.document.location.host+"/ajaxsocket");ws.onmessage=messageHandler;ws.onclose=function(a){};ws.onopen=function(a){ws.send("request=get_refresh_rate");};ws.onerror=function(a){console.log("WebSocket error",ws,a);};$("#add-torrent-button").click(function(){$("#add_torrent").dialog("open");});$("#add_torrent").dialog({height:220,width:420,modal:true,autoOpen:false,buttons:{"Add torrent":function(){if(!($("#add_torrent_input").val()))$("#add_torrent_form").css("border","1px solid red");else $("#add_torrent_form").submit();},Cancel:function(){$(this).dialog("close");}}});loadRClickMenus();$("body").bind("dragenter",function(a){if(new Date().getTime()-dragOverlayCreated>500)createDragOverlay();a.preventDefault();a.stopPropagation();return false;}).bind("dragleave",function(a){if(new Date().getTime()-dragOverlayCreated>500)destroyDragOverlay();a.preventDefault();a.stopPropagation();return false;}).bind("dragover",function(a){a.preventDefault();}).bind("drop",function(a){a.preventDefault();console.log("drop handler called");a.stopPropagation();var b=a.originalEvent.dataTransfer.files;var c=new Array();if(b.length>0){fs=new window.WebSocket(socket_protocol+"://"+window.document.location.host+"/filesocket");fs.onmessage=function(a){resp=JSON.parse(a.data);if(resp.response=="OK")$("#dragOverlayDialog-file-"+resp.id).removeClass("dragOverlayDialog-file-pending").addClass("dragOverlayDialog-file-ok");else $("#dragOverlayDialog-file-"+resp.id).removeClass("dragOverlayDialog-file-pending").addClass("dragOverlayDialog-file-bad").html(resp.filename+" upload failed: "+resp.response);c.splice(c.indexOf(resp.id),1);if(c.length==0){fs.close();destroyDragOverlay();}};fs.onclose=function(a){};fs.onopen=function(a){for(i=0;i<b.length;i++)if(b[i].type=="application/x-bittorrent"||b[i].type==""){var d=Math.random().toString(36).substr(2,5);$("<div id='dragOverlayDialog-file-"+d+"'>").addClass("dragOverlayDialog-file-pending").html("<span class='dragOverlayDialog-filename'>"+b[i].name+"</span> uploaded").appendTo("#dragOverlayDialog");var e=new FileReader();var f=b[i].name;c.push(d);e.onload=(function(a,b){return function(c){console.log(c);fs.send("FILENAME@@@"+a.name+":::ID@@@"+b+":::CONTENT@@@"+c.target.result);};})(b[i],d);e.onerror=function(a){};e.readAsDataURL(b[i]);}else $("<div />").addClass("dragOverlayDialog-file-bad").html(b[i].name+" ignored").appendTo("#dragOverlayDialog");};fs.onerror=function(a){console.log("WebSocket error",ws,a);};}else destroyDragOverlay();return false;});$(document).keydown(function(a){if(((a.ctrlKey)||(a.which==91))&&!CTRL_SELECTED){CTRL_SELECTED=true;$("#torrent_table").selectable({filter:".torrent-div",tolerance:"touch"});$("body").css({cursor:"copy"});a.preventDefault();a.stopPropagation();}});$(document).keyup(function(a){if((a.which==17)||(a.which==91)&&CTRL_SELECTED){CTRL_SELECTED=false;$("#torrent_table").selectable("destroy");$("body").css("cursor","");}});$(".torrent-div").live("click",function(a){if($(a.target).is("img"))return;if(a.ctrlKey){}else{torrent_id=$(a.target).parent().attr("id").split("torrent_id_")[1];if($.inArray(torrent_id,DROP_OPEN)==-1)drop_down(this);else drop_up(torrent_id);}});$(".batch-control").live("click",function(a){action=this.id.split("batch-")[1];torrentIDs=new Array();for(i=0;i<SELECTED.length;i++)torrentIDs.push(SELECTED[i].split("torrent_id_")[1]);if(action=="delete"||action=="remove"){SELECTED=new Array();destroyBatchActionBox();}sendme="request="+action+"_batch";sendme=sendme+"&torrentIDs="+torrentIDs.join(",");ws.send(sendme);});$("#batch-deselect").live("click",function(a){for(i=0;i<SELECTED.length;i++){torrent=$("#"+SELECTED[i]);torrent.css({"background-color":""});torrent.removeClass("ui-selected ui-selecting");}SELECTED=new Array();destroyBatchActionBox();});$("#torrent_table").live("selectableselected",function(a,b){select_group_torrent(b.selected,a);}).live("selectableunselected",function(a,b){deselect_group_torrent(b.unselected,a);}).live("selectableselecting",function(a,b){if(SELECTED.indexOf(b.selecting.id)==-1)$(b.selecting).css({"background-color":"#d9ffd9"});}).live("selectableunselecting",function(a,b){if(SELECTED.indexOf(b.unselecting.id)==-1)$(b.unselecting).css({"background-color":""});});$(".control_start_me").live("click",function(a){torrent_id=$(this).parents(".torrent-div").attr("id").split("torrent_id_")[1];command("start_torrent",torrent_id);return false;});$(".control_pause_me").live("click",function(a,b){torrent_id=$(this).parents(".torrent-div").attr("id").split("torrent_id_")[1];command("pause_torrent",torrent_id);return false;});$(".control_stop_me").live("click",function(a){torrent_id=$(this).parents(".torrent-div").attr("id").split("torrent_id_")[1];command("stop_torrent",torrent_id);return false;});$(".control_remove_me").live("click",function(a){torrent_id=$(this).parents(".torrent-div").attr("id").split("torrent_id_")[1];command("remove_torrent",torrent_id);return false;});$(".control_delete_me").live("click",function(a){torrent_id=$(this).parents(".torrent-div").attr("id").split("torrent_id_")[1];command("delete_torrent",torrent_id);return false;});});function select_group_torrent(a,b){sel_index=SELECTED.indexOf(a.id);if(sel_index!==-1){}else{SELECTED.push(a.id);a.style.backgroundColor="#AEC798";if(SELECTED.length==1)createBatchActionBox(b.pageX,b.pageY);}}function deselect_group_torrent(a,b){sel_index=SELECTED.indexOf(a.id);if(sel_index!=-1){SELECTED.splice(sel_index,1);$(a).css({"background-color":""});if(SELECTED.length==0)destroyBatchActionBox();}}function createBatchActionBox(a,b){batchActionsBox=$("<div id='batchActionBox'></div>");head=$("<div id='batch-head' class='heading'>Batch Action</div>");start=$("<img class='batch-control' id='batch-start' src='../images/start.png' title='Start Batch'>");pause=$("<img class='batch-control' id='batch-pause' src='../images/pause.png' title='Pause Batch'>");stop=$("<img class='batch-control' id='batch-stop' src='../images/stop.png' title='Stop Batch'>");startpausestop=$("<div id='batch-control-row1'></div>").append(start,pause,stop);remove=$("<img class='batch-control' id='batch-remove' src='../images/remove.png' title='Remove Batch'>");del=$("<img class='batch-control' id='batch-delete' src='../images/delete.png' title='Delete Batch'>");startpausestop.append(remove,del);deselect=$("<div id='batch-deselect'>Deselect all</div>");controls=$("<div id='batch-controls'></div>").append(startpausestop,deselect);newElem=batchActionsBox.append(head,controls);$("body").append(newElem);$("#batchActionBox").animate({"left":"0px"},200);}function destroyBatchActionBox(){$("#batchActionBox").remove();}function stripeTable(){var a=Array("blue","green");$(".torrent-div").each(function(){col=a.shift();$(this).removeClass("blue green");$(this).addClass(col);a.push(col);});}function loadRClickMenus(){$(".torrent-div.rcstart").contextMenu("right_click_start",{bindings:{"start":function(a){var b=a.id.split("torrent_id_")[1];command("start_torrent",b);},"stop":function(a){var b=a.id.split("torrent_id_")[1];command("stop_torrent",b);},"remove":function(a){var b=a.id.split("torrent_id_")[1];command("remove_torrent",b);},"delete":function(a){var b=a.id.split("torrent_id_")[1];command("delete_torrent",b);},"rehash":function(a){var b=a.id.split("torrent_id_")[1];command("hash_torrent",b);}},menuStyle:{minWidth:"10em"}});$(".torrent-div.rcpause").contextMenu("right_click_pause",{bindings:{"pause":function(a){var b=a.id.split("torrent_id_")[1];command("pause_torrent",b);},"stop":function(a){var b=a.id.split("torrent_id_")[1];command("stop_torrent",b);},"remove":function(a){var b=a.id.split("torrent_id_")[1];command("remove_torrent",b);},"delete":function(a){var b=a.id.split("torrent_id_")[1];command("delete_torrent",b);},"rehash":function(a){var b=a.id.split("torrent_id_")[1];command("hash_torrent",b);}},menuStyle:{minWidth:"10em"}});}function parse_content(a,b){data=JSON.parse(a);system=JSON.parse(data.system);$("#global_uprate").html(system.uprate+"/s");$("#global_uptot").html(system.uptot);$("#global_diskusage").html(system.diskused+" / "+system.disktotal);$("#global_downrate").html(system.downrate+"/s");$("#global_downtot").html(system.downtot);$("#global_memusage").html(system.memused+" / "+system.memtotal);$("#global_load1").html(system.load1);$("#global_load5").html(system.load5);$("#global_load15").html(system.load15);$("#global_uptime").html(system.uptime);$("#global_cpuusage").html(system.cpuusage+"%");torrent_list=$("#torrent_list").find($("tr.torrent-div"));cur_t_ids=new Array();if((DROP_OPEN.length>0)&&(data.drop_down_keys.length>0))for(i=0;i<DROP_OPEN.length;i++){tid=DROP_OPEN[i];if(data.drop_down_keys.indexOf(tid)!==-1){htmldata=data.drop_downs[tid];cur_pane=1;$("#drop_down_container_"+tid).find(".slide").each(function(a,b){if($(b).find("h2.selected").length!==0)cur_pane=a+1;});htmldata=accordionise($(htmldata),cur_pane);htmldata=filetreeise($(htmldata),tid);$("#newrow_torrent_id_"+tid+" > td").html(htmldata);}}for(i=0;i<torrent_list.length;i++){var c=$(torrent_list[i]).attr("id").split("torrent_id_")[1];cur_t_ids.push(c);if(data.torrent_index.indexOf(c)==-1){if($("#torrent_id_"+c).hasClass("old-torrent-row")){}else{if(DEL_INDEX=DELETING.indexOf(c)!=-1)DELETING.splice(DEL_INDEX,1);remove_torrentrow(c);}}else{torrent_data=data.torrents[c];if(torrent_data.completed)$("#t_name_"+c).removeClass("progress-gradient");else $("#t_name_"+c).addClass("progress-gradient").css({"background-size":torrent_data.percentage+"% 100%, 100% 100%"});$("#t_ratio_"+c).html(torrent_data.ratio).attr("title",torrent_data.up_total+" up / "+torrent_data.down_total+" down");$("#t_uprate_"+c).html(torrent_data.uprate+"/s");$("#t_downrate_"+c).html(torrent_data.downrate+"/s");var d=$("#t_status_"+c);var e=d.html();if(e!=torrent_data.status){d.html(torrent_data.status);if(($.inArray(e,statusArrayActive)!=-1)&&($.inArray(torrent_data.status,statusArrayInactive)!=-1)){$("#t_controls_"+c+" > .control_pause").replaceWith($("<span />").addClass("control_start control_button").attr("title","Start Torrent").append($("<img />").addClass("control_image control_start_me").attr("alt","Start").attr("src","../images/start.png")));$("#torrent_id_"+c).toggleClass("rcpause rcstart");loadRClickMenus();}else if(($.inArray(e,statusArrayInactive)!=-1)&&($.inArray(torrent_data.status,statusArrayActive)!=-1)){$("#t_controls_"+c+" > .control_start").replaceWith($("<span />").addClass("control_pause control_button").attr("title","Pause Torrent").append($("<img />").addClass("control_image control_pause_me").attr("alt","Pause").attr("src","../images/pause.png")));$("#torrent_id_"+c).toggleClass("rcpause rcstart");}}}}for(i=0;i<data.torrent_index.length;i++){c=data.torrent_index[i];if($.inArray(c,cur_t_ids)===-1)add_torrentrow(c,data.torrents[c],i);}loadRClickMenus();if(b==="yes")setTimeout(function(){refresh_content("yes");},refresh_rate);}function refresh_content(a){if(DROP_OPEN.length>0)req="request=get_info_multi&view="+$("#this_view").html()+"&drop_down_ids="+DROP_OPEN.join(",");else req="request=get_info_multi&view="+$("#this_view").html();if(!($("#this_sort").html()==="none"))req+="&sortby="+$("#this_sort").html();if(!($("#this_reverse").html()==="none"))req+="&reverse="+$("#this_reverse").html();ws.send(req);}function remove_torrentrow(a){var b=$("#torrent_id_"+a);if(b.length!=0){$(b).removeClass("blue green").toggleClass("old-torrent-row");$(b).effect("pulsate",{times:1},"slow",function(){$(b).fadeTo(2000,0.1,function(){$(this).slideRow("up",1000,function(){$("#torrent_id_"+a).remove();});});});}}function add_torrentrow(a,b,c){var d=$("<tr />").addClass("torrent-div").attr("id","torrent_id_"+a);if(b.completed)d.append($("<td />").attr("id","t_name_"+a).addClass("t_name").html(b.name));else d.append($("<td />").attr("id","t_name_"+a).html(b.name).addClass("progress-gradient t_name").css("background-size",b.percentage+"%, auto"));d.append($("<td />").attr("id","t_size_"+a).html(b.size)).append($("<td />").attr("id","t_ratio_"+a).attr("title",b.up_total+" up / "+b.down_total+" down").html(b.ratio)).append($("<td />").attr("id","t_uprate_"+a).html(b.uprate+"/s")).append($("<td />").attr("id","t_downrate_"+a).html(b.downrate+"/s")).append($("<td />").attr("id","t_status_"+a).html(b.status)).append($("<td />").attr("id","t_controls_"+a).append($("<span />").addClass("control_stop control_button").attr("title","Stop Torrent").append($("<img />").addClass("control_image control_stop_me").css("padding-right","4px").attr("alt","Stop").attr("src","../images/stop.png"))).append($("<span />").addClass("control_remove control_button").attr("title","Remove Torrent").append($("<img />").addClass("control_image control_remove_me").css("padding-right","4px").attr("alt","Remove").attr("src","../images/remove.png"))).append($("<span />").addClass("control_delete control_button").attr("title","Remove Torrent and Files").append($("<img />").addClass("control_image control_delete_me").css("padding-right","4px").attr("alt","Delete").attr("src","../images/delete.png"))));if($.inArray(b.status,statusArrayActive)!=-1){d.addClass("rcpause");d.find("td#t_controls_"+a).prepend($("<span />").addClass("control_pause control_button").attr("title","Pause Torrent").append($("<img />").addClass("control_image control_pause_me").css("padding-right","4px").attr("alt","Pause").attr("src","../images/pause.png")));}else{d.addClass("rcstart");d.find("td#t_controls_"+a).prepend($("<span />").addClass("control_start control_button").attr("title","Start Torrent").append($("<img />").addClass("control_image control_start_me").css("padding-right","4px").attr("alt","Start").attr("src","../images/start.png")));}$("#torrent_list > tbody > tr:eq("+c+")").after(d);}function select_torrent(a){if((SELECTED.indexOf(a.id)!==-1)&&SHIFT_SELECTED)a.style.backgroundColor="#fe0701";}function deselect_torrent(a){if(SELECTED.indexOf(a.id)!==-1)a.style.backgroundColor="#7ae41b";}function removerow(a){if(row=document.getElementById("newrow_torrent_id_"+a)){var b=document.getElementById("torrent_list");b.deleteRow(row.rowIndex);}}function drop_down(a){var b=a.id.split("torrent_id_")[1];DROP_OPEN.push(b);var c=document.getElementById("torrent_list");if(oldrow=document.getElementById('newrow_torrent_id_'+b))c.deleteRow(oldrow.rowIndex);var d=c.insertRow(a.rowIndex+1);var e=d.insertCell(0);d.id="newrow_torrent_id_"+b;d.className+="drop_down";e.id="newcell_torrent_id_"+b;e.innerHTML="<img src='/images/loading.gif'> <span style='color:red;'>Loading</span>";e.colSpan="7";var f="request=get_torrent_info&html=yesplease&torrent_id="+b;ws.send(f);}function drop_up(a){drop_index=DROP_OPEN.indexOf(torrent_id);DROP_OPEN.splice(drop_index,1);$("#newrow_torrent_id_"+a+" > td > div").slideUp("slow",function(){$("#newrow_torrent_id_"+a).remove();});}function accordionise(a,b){a.liteAccordion({containerWidth:$(".torrent-div").first().width(),firstSlide:b});return a;}function filetreeise(a,b){a.find("#drop_down_files_"+b+" > ul").treeview({collapsed:true,persist:"cookie"});return a;}function command(a,b){if($.inArray(b,DELETING)!=-1)return false;if(a==="pause_torrent"||a==="start_torrent"||a==="stop_torrent"||a=="remove_torrent"||a=="delete_torrent"||a=="hash_torrent"){var c;if(a==="remove_torrent")c=confirm("Are you sure you want to remove this torrent?");else if(a=="delete_torrent"){c=confirm("Are you sure you want to remove this torrent and *permanently* delete its files?");if(c){$("#torrent_id_"+b).addClass("deleting-torrent-row").removeClass("blue green");DELETING.push(b);}}else if(a=="hash_torrent")c=confirm("Are you sure you want to rehash this torrent?\n This process can take a long time for large torrents");else c=true;if(c){var d="request="+a+"&torrent_id="+b;ws.send(d);}else return false;}else console.log("invalid command or command not implemented");}function createDragOverlay(){if(dragOverlayOpen)return false;else{dragOverlayCreated=new Date().getTime();dragOverlayOpen=true;var a=$("<div />").addClass("dragOverlay").appendTo("body");var b=$("<div id='dragOverlayDialog' />").addClass("dragOverlayDialog").appendTo(a);}}function destroyDragOverlay(){if(dragOverlayOpen){dragOverlayOpen=false;$(".dragOverlay").each(function(a){$(this).fadeOut(2000,function(){$(this).remove();});});}}function messageHandler(a){d=JSON.parse(a.data);if(d.request=="get_info_multi")return parse_content(d.response,"yes");else if(d.request=="get_refresh_rate")refresh_rate=parseInt(d.response)*1000;else if(d.request=="get_torrent_info"){var b=d.response;newcellcontents=$(b);var c=$(".drop_down_main",newcellcontents).first().attr("id").split("drop_down_main_")[1];var d=document.getElementById("newcell_torrent_id_"+c);d.className+="drop_down_td";newcellcontents=accordionise(newcellcontents,1);newcellcontents=filetreeise(newcellcontents,torrent_id);newcellcontents.css({"display":"none"});$(d).html(newcellcontents);newcellcontents.slideDown('slow');}else if(d.request=="pause_torrent"||d.request==="start_torrent"||d.request==="stop_torrent"||d.request=="remove_torrent"||d.request=="delete_torrent"||d.request=="hash_torrent"){var e=d.response.trim();if(e=="OK"){}else console.log("Command Failed with reason: "+e);}else console.log("Unknown request");}
